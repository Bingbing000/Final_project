---
title: "Logistic regression analysis on breast cancer"
author: "Bingbing Wu"
date: "`r Sys.Date()`"
output: html_document
---

# Introduction

This is a Breast cancer Wisconsin (original) dataset contains real data of 699 observations with independent variables。We are going to perform a logistic regression analysis on a dataset to classify tumors as malignant and benign. The variable I will be predicting can have two values: 0 or 1.

#### Analysis objectives

"Benign" as opposed to "malignant" refers to a condition or growth that is not cancerous or dangerous. The dataset contains nine independent variables, each of which is a characteristic commonly used in breast cancer analysis.

* Clump Thickness: Indicates how thick cells are in a tumor. Benign cells are usually in mono-layers, while cancerous cells tend to form multi-layered clumps.
* Uniformity of Cell Size and Shape: Describes the degree of similarity in size and shape among cells in a sample when viewed under a microscope.
* Marginal Adhesion: Measures the degree to which cells in a tissue sample adhere or stick together at the edges, and loss of adhesion may suggest malignancy.
* Single Epithelial Cell Size: Refers to the size of individual cells in epithelial tissue samples, which cover the body's surface and line internal organs.
* Bare Nuclei: Indicates cells in a tissue sample without cell membranes and cytoplasm, revealing only the visible nucleus.
*  Bland Chromatin: Describes the appearance of genetic material (chromatin) in a cell's nucleus, being considered "bland" when it is compact and uniform.
* Normal Nucleoli: Small structures within the nucleus responsible for synthesizing ribosomes. Varies in size and appearance but is typically small and well-defined in healthy cells.
* Mitosis: The process of cell division essential for tissue growth and repair, where a single cell divides into two daughter cells, each containing a copy of the parent cell’s DNA.

```{r setup, include = TRUE}
# importing libraries
library(gtsummary)
library(ggplot2)
library(dplyr)
library(caret)
library(ggcorrplot)
library(ggpubr)
library(naniar)
options(warn = -1)
```

```{r}
here :: i_am ("code/Final_Project.Rmd")
```

```{r}
# importing dataset
df <- read.csv(here::here("data", "breast_cancer.csv"))
```

Data on clump thickness, cell size uniformity, cell shape uniformity, marginal adhesion, single epithelial cell size, naked nuclei, bland chromatin, normal nucleoli, and mitoses are displayed in the table along with their corresponding categories. With corresponding values for these attributes, each row depicts a unique instance of breast cancer cells. The "Class" column provides important information for additional analysis and classification activities by indicating whether the cells are classed as malignant (4) or benign (2).
```{r}
unique(df$Class)
```
There are two values: "benign" = 2 or "malignant" = 4. To construct a logistic regression model, I substituted 0 for benign and 1 for malignant values for these original values. I'm going to now examine this dataset to see if any values are missing.
```{r}
# replacing the values with 0 and 1 for the purpose of building logistic regression model
df$Class <- ifelse(df$Class == 2, 0, 1)
```

```{r}
# checking if any columns have missing values
colSums(is.na(df))
```

```{r}
# saving the cleaned data
saveRDS(
  df,
  file = here::here("clean_data/clean_data.rds")
)
```

```{r}
library(gtsummary)
# making table 
table <- df |>
  select(`Clump.Thickness`, `Bare.Nuclei`, `Bland.Chromatin`, `Normal.Nucleoli`, `Marginal.Adhesion`, Class) |>
  tbl_summary(by = Class) |>
  modify_spanning_header(c("stat_1", "stat_2") ~ "Table 1") |>
  add_overall() |>
  add_p()

saveRDS(
  table,
  file = here::here("output/Table.rds")
)
```

```{r}
# finding correlations between the variables
correlation <- cor(df[,1:10])
heatmap <- ggcorrplot(correlation, type = "lower", lab = TRUE)

ggsave("~/Desktop/FinalProject/output/correlation_heatmap.png", plot = heatmap)
```

To determine the strength of the linear association between several variables, utilize the heatmap of a correlation matrix. Every grid cell in a correlation matrix displays the correlation coefficient between two variables. A statistical metric used to characterize the strength and direction of a relationship between two variables is the correlation coefficient.
It ranges from -1 to +1, where:
* +1 indicates a perfect positive linear relationship,
* -1 indicates a perfect negative linear relationship, and
* 0 indicates no linear relationship.

1. The variables along the y-axis (from top to bottom) and the x-axis (from left to right) include Clump Thickness, Uniformity of Cell Size, Uniformity of Cell Shape, Marginal Adhesion, Single Epithelial Cell Size, Bare Nuclei, Bland Chromatin, Normal Nucleoli, Mitoses, and a category labeled as Class.
2. The variable 'Class' seems to have moderate to strong positive correlations with most of the other variables, with the strongest correlations being with 'Uniformity of Cell Size' and 'Uniformity of Cell Shape'. This suggests that these variables are good indicators of the 'Class' variable, which could be a classification outcome such as the presence or absence of a condition.
3. The 'Mitoses' variable shows weaker correlations with other variables compared to 'Uniformity of Cell Size' and 'Uniformity of Cell Shape'.
4. 'Bare Nuclei', 'Bland Chromatin', and 'Normal Nucleoli' seem to have moderate positive correlations with 'Class' and with each other.
5. 'Clump Thickness' also appears to be moderately correlated with 'Uniformity of Cell Size' and 'Uniformity of Cell Shape'.

# Analysis Visulization
#### clump thickness plot
```{r}
# clump thickness plot
ggplot() + 
  geom_point(aes(df$Clump.Thickness, df$Class)) + 
  geom_smooth(aes(df$Clump.Thickness, df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
  ggtitle("Breast Cancer Diagnosis \nusing Clump Thickness") +
  ylab("Tumour type") +
  xlab("Clump thickness") +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.title = element_text(size = 25, face="bold",
                                 margin = margin(10,0,10,0)),
       plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 15),
       axis.title.x = element_text(size = 20, margin = margin(11,0,10,0)),
       axis.text.y = element_text(size = 15),
       axis.title.y = element_text(size = 20, margin=margin(0,10,0,11)),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5,0,0, "cm"))
```

```{r}
ct <- ggplot() + 
  geom_point(aes(df$Clump.Thickness,df$Class)) + 
  geom_smooth(aes(df$Clump.Thickness,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 10),
       axis.title.x = element_blank(),
       axis.text.y = element_text(size = 10),
       axis.title.y = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5, 0, 0, "cm")) +
       annotate("text",x=7.0, y=0.2, label="Clump thickness", size = 6)

ggsave(
  here::here ("output/ct.png"), 
  plot = ct)
```
For 'Clump Thickness', the plot indicates that as the thickness increases, the probability of the tumor being malignant also increases. Data points are plotted for benign and malignant tumors at various thickness levels, and the logistic regression curve suggests that there is a threshold of clump thickness above which tumors are more likely to be classified as malignant.

#### marginal adhesion plot
```{r}
# marginal adhesion plot
ggplot() + 
  geom_point(aes(df$Marginal.Adhesion,df$Class)) + 
  geom_smooth(aes(df$Marginal.Adhesion,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
  ggtitle("Breast Cancer Diagnosis \nusing Marginal adhesion") +
  ylab("Tumour type") +
  xlab("Marginal adhesion") +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.title = element_text(size = 25, face="bold", margin = margin(10,0,10,0)),
       plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 15),
       axis.title.x = element_text(size = 20, margin = margin(11,0,10,0)),
       axis.text.y = element_text(size = 15),
       axis.title.y = element_text(size = 20, margin=margin(0,10,0,11)),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5,0,0, "cm"))
```

```{r}
# additional plot for combination
ma <- ggplot() + 
  geom_point(aes(df$Marginal.Adhesion,df$Class)) + 
  geom_smooth(aes(df$Marginal.Adhesion,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 10),
       axis.title.x = element_blank(),
       axis.text.y = element_text(size = 10),
       axis.title.y = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5, 0, 0, "cm")) +
       annotate("text",x=6.5, y=0.2, label="Marginal adhesion", size = 6)

ggsave(
  here::here ("output/ma.png"), 
  plot = ma)
```
From the plot, we observe that lower values of marginal adhesion are associated with benign tumors, while higher values tend to correlate with malignant tumors. The curve shows an increasing probability of malignancy as marginal adhesion values increase, suggesting that 'Marginal Adhesion' is a significant factor in the model and can be used to predict the malignancy of breast tumors with certain reliability.

#### Bare nuclei plot
```{r}
# Bare nuclei plot
ggplot() + 
  geom_point(aes(df$Bare.Nuclei,df$Class)) + 
  geom_smooth(aes(df$Bare.Nuclei,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
  ggtitle("Breast Cancer Diagnosis \nusing Bare nuclei") +
  ylab("Tumour type") +
  xlab("Bare nuclei") +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.title = element_text(size = 25, face="bold", margin = margin(10,0,10,0)),
       plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 15),
       axis.title.x = element_text(size = 20, margin = margin(11,0,10,0)),
       axis.text.y = element_text(size = 15),
       axis.title.y = element_text(size = 20, margin=margin(0,10,0,11)),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5,0,0, "cm"))
```
```{r}
# additional plot for combination
bn <- ggplot() + 
  geom_point(aes(df$Bare.Nuclei,df$Class)) + 
  geom_smooth(aes(df$Bare.Nuclei,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 10),
       axis.title.x = element_blank(),
       axis.text.y = element_text(size = 10),
       axis.title.y = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5, 0, 0, "cm")) +
       annotate("text",x=6.5, y=0.2, label="Bare nuclei", size = 6)

ggsave(
  here::here ("output/bn.png"), 
  plot = bn)
```
The sigmoidal curve indicates that as the number of bare nuclei increases, so does the probability of the tumor being malignant. The distribution of data points suggests a clear trend where low values of bare nuclei are mostly associated with benign tumors, while high values are predominantly associated with malignant tumors. This implies that 'Bare Nuclei' is an important predictor in the model and can be significant in distinguishing between benign and malignant breast cancer cases, which is crucial for early diagnosis and treatment planning.

#### Mitoses plot
```{r}
# Mitoses plot
ggplot() + 
  geom_point(aes(df$Mitoses,df$Class)) + 
  geom_smooth(aes(df$Mitoses,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
  ggtitle("Breast Cancer Diagnosis \nusing Mitoses") +
  ylab("Tumour type") +
  xlab("Mitoses") +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.title = element_text(size = 25, face="bold",margin = margin(10,0,10,0)),
       plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 15),
       axis.title.x = element_text(size = 20, margin = margin(11,0,10,0)),
       axis.text.y = element_text(size = 15),
       axis.title.y = element_text(size = 20, margin=margin(0,10,0,11)),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5,0,0, "cm"))
```
```{r}
# additional plot for combination
um <- ggplot() + 
  geom_point(aes(df$Mitoses,df$Class)) + 
  geom_smooth(aes(df$Mitoses,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 10),
       axis.title.x = element_blank(),
       axis.text.y = element_text(size = 10),
       axis.title.y = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5, 0, 0, "cm")) +
       annotate("text",x=6.5, y=0.2, label="Mitoses", size = 6)

ggsave(
  here::here ("output/um.png"), 
  plot = um)
```
The graph shows a sigmoidal curve, typical of logistic regression, indicating the probability of a tumor being malignant based on the rate of mitoses. The curve flattens as it approaches the higher mitoses values, suggesting that while increased mitotic activity is associated with malignancy, there is a level beyond which additional increases in mitoses do not significantly change the probability of the tumor being malignant. This could imply that 'Mitoses' is a useful predictor up to a certain point, after which other factors might be more indicative of malignancy in breast cancer diagnosis.

#### bland chromatin plot
```{r}
# bland chromatin plot
ggplot() + 
  geom_point(aes(df$Bland.Chromatin,df$Class)) + 
  geom_smooth(aes(df$Bland.Chromatin,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
  ggtitle("Breast Cancer Diagnosis \nusing Bland chromatin") +
  ylab("Tumour type") +
  xlab("Bland chromatin") +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.title = element_text(size = 25, face="bold", margin = margin(10,0,10,0)),
       plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 15),
       axis.title.x = element_text(size = 20, margin = margin(11,0,10,0)),
       axis.text.y = element_text(size = 15),
       axis.title.y = element_text(size = 20, margin=margin(0,10,0,11)),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5,0,0, "cm"))
```
```{r}
# additional plot for combination
bc <- ggplot() + 
  geom_point(aes(df$Bland.Chromatin,df$Class)) + 
  geom_smooth(aes(df$Bland.Chromatin,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 10),
       axis.title.x = element_blank(),
       axis.text.y = element_text(size = 10),
       axis.title.y = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5, 0, 0, "cm")) +
       annotate("text",x=6.5, y=0.2, label="Bland chromatin", size = 6)

ggsave(
  here::here ("output/bc.png"), 
  plot = bc)
```
The logistic curve suggests that the probability of the tumor being malignant increases with the Bland Chromatin value. Most of the benign cases cluster at the lower end of the Bland Chromatin scale, while malignant cases are more frequently found at higher values, indicating that Bland Chromatin is a significant variable in predicting the malignancy of breast tumors.

#### normal nucleoli plot
```{r}
# normal nucleoli plot
 ggplot() + 
  geom_point(aes(df$Normal.Nucleoli,df$Class)) + 
  geom_smooth(aes(df$Normal.Nucleoli,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
  ggtitle("Breast Cancer Diagnosis \nusing Normal nucleoli") +
  ylab("Tumour type") +
  xlab("Normal nucleoli") +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.title = element_text(size = 25, face="bold",margin = margin(10,0,10,0)),
       plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 15),
       axis.title.x = element_text(size = 20, margin = margin(11,0,10,0)),
       axis.text.y = element_text(size = 15),
       axis.title.y = element_text(size = 20, margin=margin(0,10,0,11)),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5,0,0, "cm"))
```
```{r}
# additional plot for combination
nn <- ggplot() + 
  geom_point(aes(df$Normal.Nucleoli,df$Class)) + 
  geom_smooth(aes(df$Normal.Nucleoli,df$Class),
              method = "glm", se = FALSE, method.args = list(family = "binomial"), 
              color = "#557153", size = 1.2) +
scale_y_continuous(breaks = c(0, 1), labels = c("Benign", "Malignant")) +
  theme(plot.background = element_rect(fill = "#F0EBCE"),
       panel.background = element_rect(fill = "#F0EBCE"),
       axis.text.x = element_text(size = 10),
       axis.title.x = element_blank(),
       axis.text.y = element_text(size = 10),
       axis.title.y = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       plot.margin = margin(0,0.5, 0, 0, "cm")) +
       annotate("text",x=6.5, y=0.2, label="Normal nucleoli", size = 6)

ggsave(
  here::here ("output/nn.png"), 
  plot = nn)
```
The sigmoid curve demonstrates that as the count of normal nucleoli increases, so does the likelihood of the tumor being malignant. The data points show a distinction between benign and malignant tumor types, with benign ones clustering at lower values of normal nucleoli, and malignant ones tending towards higher values. This suggests that the number of normal nucleoli can be a significant indicator for the malignancy of breast tumors in diagnostic models.

# Conclusion
### Including all Plots
* Clump Thickness: Higher clump thickness values increase the likelihood of malignancy.
* Marginal Adhesion: As marginal adhesion values rise, so does the probability of cancer being malignant.
* Bare Nuclei: The presence of a higher number of bare nuclei is associated with a greater chance of malignancy.
* Normal Nucleoli: Increased normal nucleoli counts are linked to higher malignancy probabilities.
* Mitoses: More frequent mitoses indicate a higher risk of malignancy, although the relationship plateaus at higher values.
* Bland Chromatin: A higher bland chromatin value suggests a greater probability of malignancy.
Each factor's analysis supports its use as a predictive variable for breast cancer malignancy, with the logistic regression model providing a probability estimation that can help in medical diagnosis and treatment decision-making


